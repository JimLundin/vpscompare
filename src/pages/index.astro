---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import VPSGrid from '../components/vps/VPSGrid.astro';
import VPSFilters from '../components/vps/VPSFilters.astro';
import ErrorBoundary from '../components/layout/ErrorBoundary.astro';

// Fetch VPS plans from content collection with error handling
let vpsPlans;
let error = null;

try {
	vpsPlans = await getCollection('vpsPlans');
} catch (e) {
	console.error('Failed to load VPS plans:', e);
	error = e;
	vpsPlans = [];
}

// Add metadata for SEO
const title = 'VPS Compare - Find the Best VPS Hosting';
const description = 'Compare VPS hosting plans from top providers. Find the perfect balance of price, performance, and features for your needs.';
---

<Layout title={title}>
	<main class="main-content">
		<!-- Hero Section -->
		<section class="hero-section">
			<div class="container">
				<div class="hero-content">
					<h1 class="hero-title">
						<span class="hero-gradient">VPS Compare</span>
					</h1>
					<p class="hero-description">
						Find the perfect VPS hosting solution for your needs. Compare prices, specifications, 
						and features from top providers in one place.
					</p>
					<div class="hero-features">
						<div class="feature-item">
							<svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
								<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
							</svg>
							Real-time pricing
						</div>
						<div class="feature-item">
							<svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
								<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
							</svg>
							Detailed comparisons
						</div>
						<div class="feature-item">
							<svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
								<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
							</svg>
							Trusted providers
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Main Content -->
		<section class="content-section">
			<div class="container">
				{error ? (
					<div class="error-container">
						<ErrorBoundary 
							fallback="Failed to load VPS plans. Please check your connection and try again."
						/>
					</div>
				) : vpsPlans.length === 0 ? (
					<div class="empty-state">
						<div class="empty-title">No VPS plans available</div>
						<div class="empty-subtitle">Please check back later</div>
					</div>
				) : (
					<>
						<!-- Filters -->
						<VPSFilters plans={vpsPlans} />
						
						<!-- Results Summary -->
						<div class="results-summary">
							<p>
								Showing <span class="highlight">{vpsPlans.length}</span> VPS plans from 
								<span class="highlight">{new Set(vpsPlans.map(p => p.data.provider)).size}</span> providers
							</p>
						</div>

						<!-- VPS Grid -->
						<div id="vps-grid">
							<VPSGrid plans={vpsPlans} />
						</div>
					</>
				)}
			</div>
		</section>

		<!-- Footer -->
		<footer class="footer">
			<div class="container">
				<div class="footer-content">
					<p>© 2024 VPS Compare. Data updated regularly from provider websites.</p>
					<p class="footer-links">
						<a href="#" class="footer-link">Privacy Policy</a> • 
						<a href="#" class="footer-link">Terms of Service</a> • 
						<a href="#" class="footer-link">Contact</a>
					</p>
				</div>
			</div>
		</footer>
	</main>
</Layout>

<style>
	.main-content {
		min-height: 100vh;
	}

	.hero-section {
		background: white;
		border-bottom: 1px solid #e5e7eb;
	}

	.hero-content {
		text-align: center;
		padding: 4rem 0;
	}

	.hero-title {
		font-size: 3rem;
		font-weight: 700;
		color: #111827;
		margin-bottom: 1.5rem;
	}

	.hero-gradient {
		background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #1d4ed8 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.hero-description {
		font-size: 1.25rem;
		color: #6b7280;
		max-width: 48rem;
		margin: 0 auto 2rem auto;
		line-height: 1.6;
	}

	.hero-features {
		display: flex;
		flex-direction: column;
		gap: 1rem;
		align-items: center;
	}

	.feature-item {
		display: flex;
		align-items: center;
		font-size: 0.875rem;
		color: #6b7280;
	}

	.feature-icon {
		width: 1.25rem;
		height: 1.25rem;
		margin-right: 0.5rem;
		color: #10b981;
	}

	.content-section {
		padding: 3rem 0;
	}

	.error-container {
		max-width: 32rem;
		margin: 0 auto;
	}

	.empty-state {
		text-align: center;
		padding: 3rem 0;
	}

	.empty-title {
		color: #6b7280;
		font-size: 1.125rem;
		margin-bottom: 0.5rem;
	}

	.empty-subtitle {
		color: #9ca3af;
		font-size: 0.875rem;
	}

	.results-summary {
		margin-bottom: 1.5rem;
	}

	.results-summary p {
		font-size: 0.875rem;
		color: #6b7280;
	}

	.highlight {
		font-weight: 500;
		color: #111827;
	}

	.footer {
		background: white;
		border-top: 1px solid #e5e7eb;
		margin-top: 4rem;
	}

	.footer-content {
		text-align: center;
		padding: 2rem 0;
		font-size: 0.875rem;
		color: #6b7280;
	}

	.footer-links {
		margin-top: 0.5rem;
	}

	.footer-link {
		color: #6b7280;
		transition: color 0.2s ease;
	}

	.footer-link:hover {
		color: #374151;
	}

	@media (min-width: 640px) {
		.hero-features {
			flex-direction: row;
			justify-content: center;
		}
	}

	@media (min-width: 768px) {
		.hero-title {
			font-size: 4rem;
		}
	}

	@media (min-width: 1024px) {
		.hero-title {
			font-size: 5rem;
		}
	}
</style>
